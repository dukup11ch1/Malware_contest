#-*- coding: utf-8 -*-
import pefile
import parse_filelist
import sys

reload(sys)
sys.setdefaultencoding('utf-8')

files = parse_filelist.allfiles(sys.argv[1])

for pe in files:
    try:
        pf=pefile.PE(pe)
    except:
        print "may be \""+pe+"\" is not pefile"
        continue
    flag=True
    for i in range(len(pf.sections)):
        if i == 1 or i==3:
            data= pf.sections[i].get_data()
            next_data=data
            while True:
                try:
                    data=next_data
                    offset = 0
                    a=data.find('BOBD')
                    if a==-1:
                        break
                    next_data=data[a+4:]
                    offset=ord(data[a+4])
                    idx=a+4
                    if data[idx+offset]=='F':
                        idx=idx+offset+1
                        offset=ord(data[idx])
                        if data[idx+offset]=='N':
                            idx=idx+offset+1
                            offset=ord(data[idx])
                            if data[idx+offset]=='O':
                                idx=idx+offset+1
                                offset=ord(data[idx])
                                
                                if data[idx+offset]=='1':
                                    flag=False
                except:
                    pass
    
    if flag:
        print pe.decode('cp949') + u' 정상'
    else :
        print pe.decode('cp949') + u' 악성'
        